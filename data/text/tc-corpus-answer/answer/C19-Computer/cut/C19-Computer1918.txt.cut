微型,微型机,应用,
MICROCOMPUTER,ITS,APPLICATIONS
2000,Vol,19,No,P,24




Windows,9x,准,实时,通信,控制,控制系统,系统,设计,马,卫东,王,志,颖,摘要,Windows,9x,开发,开发设计,设计,底层,硬件,实时,准,实时,通信,控制,控制软件,软件,软件系统,系统,方法,Windows,9x,设备,驱动,驱动程序,程序,VxD,编程,动态,连接,库,接口,Win32,程序,程序设计,设计,任务,任务调度,调度,进行,较为,深入,探讨,关键,关键词,Windows,9x,准,实时,通信,设备,驱动,驱动程序,程序,事件,线程,任务,任务调度,调度,Windows,9x,运行,80386,其后,后继,产品,通用,桌面,计算,计算机,算机,图形,图形用户界面,用户,用户界面,界面,操作,操作系统,系统,支持,抢先,式,多任务,任务,多线,多线程,线程,虚,存,管理,局域,局域网,局域网络,网络,TCP,IP,协议,Internet,丰富,功能,已成,成为,应用,广泛,桌面,桌面操作系统,操作,操作系统,系统,Windows,9x,通用,桌面,计算,计算机,算机,机设,设计,操作,操作系统,系统,实时,时任,任务,设计,无法,简便,程序,程序设计,设计,方法,直接,创建,实时,通信,控制,任务,工业,交通,国防,测控,部门,要求,求进,进行,实时,时任,任务,处理,原来,DOS,系统,开发,实时,时任,任务,处理,处理程序,程序,存在,移植,Windows,9X,平台,台上,上来,重新,实现,问题,本文,问题,进行,探讨,Windows,9x,操作,操作系统,系统,系统结构,结构,简述,Windows,9x,运行,80x86,保护,保护模式,模式,操作,操作系统,系统,系统核心,核心,代码,线程,调度,存储,存储管理,管理,设备,驱动,程序,运行,拥有,特权,级,核心,心态,Ring,级,操作,操作系统,系统,代码,GUI,程序,用户,进程,运行,用户,态,Ring,级,基本,结构,图,所示,

,图,Windows,9x,操作,操作系统,系统,系统结构,结构,结构图,构图,Windows,9x,操作,操作系统,系统,能够,时运,运行,MS,DOS,程序,Win16,程序,Win32,程序,彼此间,互不,干扰,并发,执行,建议,Windows,9x,开发,应用,应用程序,程序,首选,Win32,程序,Windows,9x,Win32,应用,应用程序,程序,提供,32,高达,4GB,全线,线性,虚拟,虚拟地址,地址,空间,应用,来讲,提供,足够,可用,可用内存,内存,计算,计算机,算机,物理,内存,容量,情况,小得多,Windows,9x,操作,操作系统,系统,统由,核心,设备,驱动,驱动程序,程序,大量,动态,动态链接库,链接,链接库,应用,应用程序,程序,组成,Windows,9x,内核,设备,驱动,驱动程序,程序,程序运行,运行,保护,保护模式,模式,Ring,级,称为,核心,心态,应用,应用程序,程序,动态,动态链接库,链接,链接库,运行,Ring,级,称为,用户,态,熟悉,80386,保护,保护模式,模式,体系,知道,Ring3,代码,不能,直接,调用,Ring,代码,Windows,9x,Win32,应用,应用程序,程序,调用,设备,驱动,驱动程序,程序,提供,一个,标准,调用,设备,文件,句柄,硬件,设备,驱动,驱动程序,程序,通信,设备,文件,句柄,标准,Win32,API,调用,CreateFile,以使,使用,ReadFile,WriteFile,设备,读写,内容,使用,DeviceIoControl,控制,设备,驱动,驱动程序,程序,具体操作,体操,操作,Windows,9x,操作,操作系统,系统,硬件,设备,打交道,交道,程序,程序代码,代码,必须,运行,核心,心态,Ring,级,事实,事实上,代码,Windows,9x,设备,驱动,驱动程序,程序,运行,用户,态,Ring,级,代码,必须,核心,心态,Ring,级,代码,访问,硬件,通常,用户,态,Ring,级,执行,所谓,输入,输入输出,输出,指令,in,out,实际,实际上,隐含,调用,核心,心态,Ring,级,代码,得以,执行,Windows,9x,开发,开发设计,设计,底层,硬件,实时,通信,控制,控制软件,软件,软件系统,系统,构造,良好,好性,性能,设备,驱动,驱动程序,程序,息息相关,相关,专用,实时,通信,控制,设备,驱动,驱动程序,程序,非常,高效,方便,而其,编制,却是,是非,非常,困难,复杂,事实,事实上,测控,部门,不要,要求,严格,实时,实时控制,控制,需要,秒,级,毫秒,级,响应,控制,时间,称之为,之为,为准,实时,通信,控制,控制系统,系统,对准,实时,通信,控制,控制系统,系统,一种,简便,有效,实现,途径,构造,一个,标准,设备,驱动,驱动程序,程序,VxD,一组,通信,控制,制动,动态,动态链接库,链接,链接库,API,设备,测控,代码,运行,用户,态,应用,应用程序,程序,完成,保证,响应,时间,毫秒,级,准,实时,通信,控制,控制软件,软件,软件系统,系统,设计,实现,原理,Windows,9x,操作,操作系统,系统,线程,基本,调度,单位,通常,常以,20ms,基本,时间,片,优先,优先级,大小,线程,进行,调度,一个,进程,创建,创建,主线,线程,多个,线程,每个,线程,必须,从属,属于,一个,优先,优先级,指定,优先,优先级,优先,优先级,属于,IDLE,PRIORITY,CLASS,优先,优先级,IDLE,程序,屏幕,保护,进程,使用,优先,优先级,10,属于,NORMAL,PRIORITY,CLASS,优先,优先级,通常,应用,应用程序,程序,使用,优先,优先级,11,15,属于,HIGH,PRIORITY,CLASS,优先,优先级,内核,线程,使用,优先,优先级,16,31,属于,REALTIME,PRIORITY,CLASS,优先,优先级,实时,时任,任务,务使,使用,一个,优先,优先级,几个,级别,包括,16,实时,级别,15,变量,量级,级别,系统,级别,空闲,级别,Win32,提供,若干,若干种,同步,对象,临界,区,互斥,量,信号,信号量,事件,线程,相互,相互之间,之间,能够,同步,同步,对象,优先,优先级,配合,使用,巧妙,设计,实现,多个,线程,并发,操作,一个,高,优先,优先级,线程,时刻,准备,处理,外部,突发,突发事件,事件,有事,事件,到来,事件,底层,设备,驱动,驱动程序,程序,激活,立刻,投入,运行,Windows,9x,支持,抢先,式,多任务,任务,拥有,高,优先,优先级,线程,优先,投入,运行,一个,分片,周围,该线,线程,即可,投入,运行,实现,准,实时,通信,控制,其实,实现,原理,图,所示,

,图,准,实时,通信,控制,实现,原理,原理图,实现,途径,准,实时,通信,控制,实现,需要,解决,几个,关键,关键问题,问题,线程,同步,步调,调度,事件,同步,驱动,建立,应用,应用层,核心,驱动,驱动程序,程序,通信,设备,驱动,驱动程序,程序,程序编制,编制,应用,应用层,事件,对象,象传,传递,递给,设备,驱动,驱动程序,程序,何在,设备,驱动,驱动程序,程序,激活,事件,等待,激励,事件,测控,线程,立刻,投入,运行,Win32,SDK,Win32,DDK,找到,相关,关文,文档,解决,难题,限于,篇幅,下面,几个,关键,关键问题,问题,讨论,事件,对象,线程,同步,一个,线程,线程,同步,方法,睡眠,在此之前,之前,必须,告诉,操作,操作系统,系统,统一,特殊,事件,发生,必须,唤醒,继续,继续执行,执行,操作,操作系统,系统,该线,线程,睡眠,一直,监视,特殊,事件,是否,发生,发生,发生,唤醒,该线,线程,线程,就绪,状态,线程,优先,优先级,调度,得以,继续,继续执行,执行,该线,线程,执行,事件,发生,取得,同步,Win32,提供,几个,API,调用,用以,实现,功能,常用,有如,函数,DWORD,WaitForSingleObject,HANDLE,hHandle,DWORD,dwMilliseconds,DWORD,WaitForMultipleObjects,DWORD,nCount,CONST,HANDLE,lpHandles,BOOL,fWaitAll,DWORDdwMilliseconds,WaitForSingleObject,函数,第一,第一个,一个,参数,同步,对象,句柄,第二,第二个,二个,参数,等待,等待时间,时间,通常,INFINITE,使用,事件,对象,同步,对象,事件,使用,CreateEvent,函数,创建,采用,全局,唯一,有名,事件,进程,内部,使用,无名,事件,事件,可用,SetEvent,函数,触发,设备,驱动,驱动程序,程序,触发,Win32,事件,设备,驱动,驱动程序,程序,触发,Win32,事件,考虑,实现,细节,需要,采用,用汇,汇编,汇编语言,语言,言实,实现,限于,篇幅,简单,介绍,核心,调用,VxDcall,VWIN32,SetWin32Event
,功能,设置,指定,事件,对象,发信,发信号,信号,状态,一个,手动,复位,事件,保持,发信,发信号,信号,状态,明确,复位,当前,前所,该事,事件,阻塞,线程,部标,阻塞,一个,自动,复位,事件,一个,等待,线程,标,阻塞,阻塞状态,状态,调用,使用,EAX,ECX,EDX,Flags,寄存,寄存器,调用,成功,EAX,寄存,寄存器,返回,零,失败,表示,VxD,事件,对象,句柄,存入,EAX,VxD,句柄,Win32,函数,OpenVxDHandle,创建,ring,句柄,详见,节,注意,该服,服务,当前,虚拟,虚拟机,系统,虚拟,虚拟机,机时,能够,调用,Win32,核心,对象,句柄,转换,Windows,9x,提供,kernel32,dll,动态,动态链接库,链接,链接库,一个,未公开,公开,API,调用,OpenVxDHandle,作用,Win32,程序,使用,句柄,转换,换为,核心,设备,能够,使用,句柄,核心,运行,代码,Win32,运行,代码,操作,同一,同一个,一个,对象,该函,函数,原型,DWORD,cdecl,OpenVxDHandle,HANDLE,hSource,下方,方法,获取,API,调用,typedef,UINT,CALLBACK,LPFNDLLFUNC1,DWORD,
LPFNDLLFUNC1,lpfnDllFunc1,Function,pointer
,DWORD,dwParam1,DWORD,uReturnVal,DWORD,cdecl,myOpenVxDHandle,HANDLE,hSource,HINSTANCE,hDLL,Handle,to,DLL
,hDLL,LoadLibrary,Kernel32,DLL,if,hDLL,NULL,lpfnDllFunc1,LPFNDLLFUNC1,GetProcAd,dress,hDLL,OpenVxDHandle,if,lpfnDllFunc1,handle,the,error
,FreeLibrary,hDLL,return,else
,call,the,function
,uReturnVal,lpfnDllFunc1,hSource,设备,驱动,驱动程序,程序,编制,编制,设备,驱动,驱动程序,程序,主要,要使,使用,Win32,DDK,一些第三,第三,第三方,三方,厂家,提供,较为,便宜,集成,集成化,成化,化开,开发,开发工具,工具,设备,驱动,驱动程序,程序,编制,需要,多篇,篇幅,介绍,细述,结束,结束语,Windows,9x,开发,开发设计,设计,底层,硬件,实时,准,实时,通信,控制,控制软件,软件,软件系统,系统,一项,有意,有意思,意思,工作,在编,编制,测控,软件,数据,同步,传输,软件,应用,设计,思想,取得,了事,事半功倍,效果,本文,给出,设计,思路,具有,广泛,实用,实用价值,价值,马,卫东,中国,中国工程物理研究院,工程,物理,研究,研究院,计算,计算机,算机,应用,研究,研究所,621900,王,志,颖,中国,中国工程物理研究院,工程,物理,研究,研究院,电子,工程,研究,研究所,收稿,日期,1999,12,28
