计算,计算机,算机,应用,研究,
APPLICATION,RESERCH,OF,COMPUTERS
2000,Vol,17,No,P,111,113




,微机,打印,打印口,口中,中断,方式,编程,编程技术,技术,应用,郭,福田,李,信,刘,贤,梅,摘,C,语言,言中,中断,方式,编程,方法,结合,打印,打印口,中断,功能,讨论,中断,方式,打印,打印口,编程,给出,一个,简单,应用,实例,关键,关键词,打印,打印口,中断,输入,输入输出,输出,ISR
1,引言,目前,微机,普及,微机,数据,采集,控制,过程,应用,越来,越来越,越多,开发,微机,硬件,接口,建立,工业,控制,控制系统,系统,主要,工作,一种,简单,快捷,方法,利用,利用微,微机,已有,接口,微机,打印,打印口,方便,构成,工业,控制,数据,采集,系统,工业,控制,控制系统,系统,数据,采集,通常,常采,采用,两种,方式,一种,查询,方式,一种,中断,方式,实时,实时性,要求,高,场合,通常,选用,中断,方式,即有,中断,中断请求,请求,暂停,正在,进行,程序,转而,执行,想要,做,事情,完成,程序,回到,原,中断,继续,继续执行,执行,下文,讨论,采用,C,语言,言中,中断,方式,编程,方法,打印,打印口,接口,原理,中断,方式,打印,打印口,编程,结合,合一,一个,简单,实例,介绍,打印,打印口,口中,中断,方式,编程,实现,过程,微机,中断,基础,基础知识,知识,中断,控制,计算,计算机,计算机技术,算机,技术,一个,重要,组成,组成部分,部分,提高,系统,实时,实时性,提高,计算,计算机,算机,工作,工作效率,效率,微机,共,设置,256,中断,可分,分为,三类,内中,中断,系统,内部,出错,CPU,遇到,除数,零,运算,溢出,情况,需要,立即,处理,一类,中断,中断,硬,中断,外部,外部设备,设备,CPU,申请,中断,服务,软,中断,硬件,控制,完成,常用,子,功能,底部,程序,方便,软件,编程,编程人员,人员,设计,无论是,一种,中断,类型,计算,计算机,算机,给予,统一,编号,统一,一管,管理,计算,计算机,算机,一个,中断,服务,服务程序,程序,interrupt,service,routine,下文,文简,简称,ISR,入口,地址,中断,号,顺序,别存,存在,计算,计算机,算机,绝对,地址,0x00000,微机,地址,分为,段,地址,偏移,地址,两部,部分,段,地址,偏移,地址,需用,16,二进制,进制,制表,表示,一中,中断,程序,入口,地址,占,字节,中断,中断向量,向量,256,中断,占用,1024,字节,数据,空间,空间,即为,中断,中断向量,向量,量表,一中,中断,发生,微机,中断,中断向量,向量,量表,可知,知道,处理,中断,中断,中断向量,向量,量表,中大,大部,大部分,部分,分内,内容,计算,计算机,算机,启动,启动时,时装,装入,系统,运行,行时,进行,修改,中断,中断向量,向量,内存,0x00000,INT0,占用,0x00000,0x00001,0x00002,0x00003,单元,INT1,占用,单元,INT,0x08,16,硬件,中断,两个,Intel,8259,中断,控制,芯,相连,常,记作,IRQ0,IRQ15,INT8,对应,应于,IRQ0,使用,0x0020,单元,INT9,对应,应于,IRQ1,0x0024,IRQ7,打印,打印机,印机,端口,LPT1,相连,硬件,相关,中断,中断向量,向量,量表,图,

,图,部分,硬件,中断,中断向量,向量,利用,debug,检查,IRQ0,IRQ7,中断,中断向量,向量,量表,方法,d,00000,0020,20
B3,10,3B,0B,73,2C,3B,0B,57,00,70,03,8B,3B,3B,0B
ED,3B,3B,0B,AC,3A,3B,0B,B7,00,70,03,F4,06,70,00
,看到,ISR,地址,IRQ0,INT8,0B3B,10B3,IRQ7,INT15,16,进制,制表,表示,INT0x0f,0070,06F4,IRQ7,中断,发生,对应,中断,INT,0x0f,中断,程序,地址,0070,06F4,打印,打印口,口中,中断,功能,能及,编程,编程技术,技术,下面,打印,打印口,口中,中断,功能,一介,介绍,逐一,一介,介绍,C,语言,编写,中断,程序,应,注意,问题,修改,中断,中断向量,向量,量表,中断,屏蔽,IRQ7,产生,控制,中断,服务,服务程序,程序,ISR
,打印,打印口,口中,中断,功能,分析,微机,接口,电路,可知,打印,打印口,ACK,接收,认可,引脚,实现,中断,中断,实现,打印,打印机,打印机接口,印机,接口,接口卡,微机,8259,中断,控制,控制器,控制,两级,控制,打印,打印机,打印机接口,印机,接口,接口卡,控制,ACK,信号,产生,中断,中断请求,请求,信号,IRQ7,讲,控制,口中,决定,打印,打印机,印机,ACK,反相,驱动,成为,中断,中断请求,请求,IRQ7,信号,送入,8259,中断,控制,控制器,该位,缺省,通常,不会,产生,IRQ7,数据,采集,控制,控制系统,系统,提高,系统,实时,实时性,常常,需要,采用,中断,方式,IRQ,Enable,设为,ACK,信号,变为,产生,中断,IRQ7,8259,允许,IRQ7,申请,中断,温度,监视,监视系统,系统,监视,温度,过程,ACK,引脚,输入,一个,中断,信号,如在,图,中断,信号,产生,电路,按钮,S1,ACK,变为,产生,中断,IRQ7,系统,转入,ISR,ISR,处理,事情,记下,系统,时间,日期,并存,存入,一个,文件,完成,工作,系统,继续,监视,温度,变化,修改,中断,中断向量,向量,量表,假设,要使,INT15,中断,发生,程序,程序执行,执行,用户,irq7,int,serv,中断,程序,达到,目的,应该,修改,中断,中断向量,向量,量表,修改,之前,应该,保存,原来,向量,退出,ISR,恢复,恢复原,复原,原来,
Borland,C,提供,相应,功能,
int,intlev,0x0f,
oldfunc,getvect,intlev,保存,0x0f,中断,中断向量,向量,留,恢复,复用,
setvect,intlev,irq7,int,serv,用户,ISR,地址,放入,0x0f,irq7,int,serv,用户,ISR,名,获得,INT,0x0f,中断,中断向量,向量,存为,变量,oldfunc,设置,INT,0x0f,入口,地址,irq7,int,serv,地址,完成,应,恢复,
setvect,intlev,oldfunc,中断,屏蔽,中断,屏蔽,一中,中断,屏蔽,计算,计算机,算机,忽略,中断,响应,需要,中断,屏蔽,设为,Enabled,允许,开放,中断,微机,端口,0x21,用于,中断,屏蔽,开放,一个,中断,将相,相应,清零,不要,影响,开放,IRQ7,中断,方法,
mask,inportb,0x21,0x80,取得,原,屏蔽,字,设为,不变,
outportb,0x21,mask,IRQ7,中断,中断请求,请求,程序,无条件,条件,转到,irq7,int,serv,程序,ISR,ISR,必须,下面,命令,结束,中断,通知,8259,中断,处理,
outportb,0x20,0x20,退出,系统,程序,之前,应该,恢复,恢复系,系统,原始,状态,设置,中断,屏蔽,字位,l,恢复,中断,屏蔽,字,禁止,IRQ7,中断,
mask,inportb,0x2l,0x80,
outportb,0x21,mask,
setvect,intlev,oldfunc,IRQ7,产生,控制,表,l,控制,口中,功能,76543210
,功能,保留,保留,保留,IRQ,Enable,Select,InInit,Auto,FeedStrobe

,打印,打印口,口上,ACK,信号,产生,IRQ7,控制,口中,IRQ,Enable,中断,允许,请求,控制,参见,表,产生,中断,设置,8259,中断,控制,控制器,屏蔽,字,允许,IRQ7,中断,必须,设置,打印,打印机,印机,控制,口,IRQ,Enable,IRQ,Enable,ACK,输入,引脚,脚上,上有,负,跳变,允许,产生,IRQ7,ACK,输入,不会,产生,IRQ7,设置,IRQ,Enable,方法,
mask,inportb,0x2l,0x80,
outportb,0x21,mask,
outportb,CONTROL,inportb,CONTROL,0x10,注意,意在,设置,控制,口,应,保持,不变,退出,程序,以前,应,控制,口,原来,清,
outportb,CONTROL,inportb,CONTROL,0xl0,中断,服务,服务程序,程序,ISR
,理论,ISR,做,何事,事情,外部,事件,要求,中断,ISR,记录,录下,系统,时钟,打开,一个,文件,时间,信息,写入,文件,关闭,文件,返回,主程序,程序,事实,事实上,ISR,编程,一定,限制,可使,使用,下述,方法,屏蔽,屏蔽其,中断,ISR,设置,一个,变量,表明,中断,已经,发生,outportb,0x20,0x20,结束,中断,开放,中断,进入,ISR,关闭,中断,断后,应,避免,使用,C,语言,函数,打开,文件,函数,C,语言,中断,方式,磁盘,通信,中断,已经,关闭,系统,无法,响应,死机,简单,单系,系统,可使,使用,上述,设置,中断,发生,生变,变量,方法,更,复杂,情况,可使,使用,下述,方法,关闭,中断,disable,屏蔽,IRQ7,中断,outportb,0x20,0x20,允许,中断,enable,做,事情,disable,允许,IRQ7,中断,enable,一种,方法,不同,ISR,不能,进入,IRQ7,中断,允许,中断,允许,C,语言,函数,工作,编程,举例,下面,一具,程序,TIME,INT,C,介绍,打印,打印口,口中,中断,方式,编程,实现,过程,介绍,程序,注释,程序,当中,中断,发生,记录,系统,时间,显示,两次,中断,时间,时间差,程序,中用,全局,全局变量,变量,int,occurred,记录,中断,是否,发生,程序,声明,明为,FALSE,中断,发生,设置,TRUE,主程序,程序,判断,int,occurred,TRUE,计算,两次,中断,时间,时间差,程序,TIME,INT,ISR,记录,打印,打印口,中断,发生,中断,ACK,低电平,电平,平产,产生,端口,端口地址,地址,0x0378,相关,关中,中断,IRQ7,计算,时间,显示,两次,中断,时间,时间差,
#include,stdio,h,
#include,bios,h,
#include,dos,h,
#include,sys,timeb,h,
#define,DATA,0x0378
#define,STATUS,DATA+1
#define,CONTROL,DATA+2
#define,TRUE,1
#define,FALSE,0
void,open,intserv,void,
void,close,intserv,void,
void,int,processed,void,
void,interrupt,far,intserv,void,
int,intlev,0x0f,采用,中断,源,IRQ7
void,interrupt,far,oldfunc,
int,int,occured,FALSE,记录,中断,发生,
int,main,void,int,first,FALSE,int,secs,msecs,struct,timeb,tl,t2,open,intserv,outportb,CONTROL,inportb,CONTROL,0x10,设置,控制,口,IRQ,enable,while,l,if,int,occurred,int,occurred,FALSE,中断,发生,生变,变量,复位,if,first,FALSE,取得,第一,第一次,一次,中断,时间,ftime,t2,first,TRUE,else
,tl,t2,保存,第一,第一次,一次,中断,时间,ftime,t2,计算,时间,时间差,secs,t2,time,t1,time,msecs,t2,millitm,t1,millitm,if,msecs,secs,msecs,msecs+1000,printf,中断,时间,时间差,d,n,1000,secs+msecs,
close,intserv,
return,void,interrupt,far,intserv,void,ISR,必须,清除,中断,源,清,8259
,disable,int,processed,通知,8259,中断,结束,int,occurred,TRUE,记录,中断,发生,enable,
void,open,intserv,void,允许,IRQ7,中断,中断,发生,ACK,低,跳到,intserv
,注意,设置,关闭,中断,设置,开放,中断,int,int,mask,disable,关闭,中断,oldfunc,getvect,intlev,保存,原,中断,中断向量,向量,setvect,intlev,intserv,建立,立新,中断,中断向量,向量,int,mask,inportb,0x21,读取,中断,屏蔽,字,outportb,0x21,int,mask,0x80,设置,允许,IRQ7,而其,不变,enable,开放,中断,
void,close,intserv,void,关闭,IRQ7,中断,int,int,mask,disable,setvect,intlev,oldfunc,恢复,恢复原,复原,中断,中断向量,向量,int,mask,inportb,0x21,0x80,设置,禁止,IRQ7,而其,不变,outportb,0x21,int,mask,enable,
void,int,processed,void,通知,8259,中断,结束,outportb,0x20,0x20,小结,前面,介绍,初学,初学者,学者,看来,掌握,中断,编程,事实,事实上,十分,简单,本文,主要,讨论,打印,打印口,口中,使用,中断,技术,技术,打印,打印口,用于,种数,数据,采集,控制,项目,目中,本文,文采,采用,中断,编程,方法,同样,可用,用于,ISA,总线,中断,过数,数据,采集,板,进行,控制,系统,郭,福田,大庆,石油,石油学院,学院,计算,计算机,计算机系,算机,系,黑龙江,龙江,江安,安达,151400,李,信,大庆,石油,石油学院,学院,计算,计算机,计算机系,算机,系,黑龙江,龙江,江安,安达,151400,刘,贤,梅,大庆,油,学院,计算,计算机,计算机系,算机,系,黑龙江,龙江,江安,安达,151400,参考,参考文献,文献,张,利,PC,机,打印,打印口,原理,应用,开发,清华,清华大学,清华大学出版社,华大,大学,出版,出版社,1996
2,张,昆,藏,IBM,微型,计算,计算机,算机,接口,接口技术,口技,技术,清华,清华大学,清华大学出版社,华大,大学,出版,出版社,1991
,收稿,日期,1999,月,日