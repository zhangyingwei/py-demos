微型,微型机,应用,
MICROCOMPUTER,ITS,APPLICATIONS
1999,18,卷,Vol,18,No,1999



FoxPro,for,Windows,环境,单片,单片机,串行,通信,实现,周,卫,平,周,斌,摘,FoxPro,for,Windows,环境,PC,机,单片,单片机,之间,进行,串行,通信,硬件,接口,设计,软件,实现,方法,关键,关键词,串行,通信,单片,单片机,FoxPro,for,Windows,应用,应用程序,程序,编程,接口,单片,单片机,因其,优点,嵌入,嵌入式,过程,程控,控制,自动,自动化,仪器,仪器仪表,仪表,数据,采集,处理,计算,计算机,计算机系,计算机系统,算机,机系统,系统,外设,已得,得到,广泛,广泛应用,应用,利用,FoxPro,for,Windows,提供,API,库,FOXTOOLS,FLL,访问,Windows,特殊,殊功,功能,FoxPro,for,Windows,语言,环境,下直,直接,实现,计算,计算机,算机,通信,硬件,接口,电路,接口,电路,结构,图,PC,机,单片,单片机,一对,一对一,一连,连接,采用,RS,232C,全双工,双工,串行,通信,方式,PC,机,串行,串行口,连接,芯,D,型,插座,引脚,定义,对应,信号,电平,平均,RS,232C,标准,标准规,标准规定,规定,连接,设计,设计,使用,信号,信号线,发送,发送数据,数据,TXD,接收,接收数据,数据,RXD,信号,GND,

,图,PC,机,单片,单片机,之间,串行,串行接口,接口,硬件,结构,结构图,构图,RS,232C,标准,标准接口,接口,输入,输出,信号,电平,EIA,电平,输入,信号,逻辑,15,3V,通常,常用,12V,逻辑,+3,+15V,通常,常用,+12V,输出,信号,逻辑,15,5V,通常,常用,12V,逻辑,+5,+15V,通常,常用,+12V,单片,单片机,应用,用电,电路,输入,输出,信号,电平,CMOS,TTL,电平,实现,RS,232C,方式,PC,机,单片,单片机,之间,输入,输出,信号,电平,匹配,RS,232C,接口,单片,单片微,微处理机,处理,处理机,串行,串行口,之间,MAX232,实现,EIA,电平,CMOS,TTL,电平,之间,相互,互转,转换,MAX232,+5V,电源,供电,内部,使用,升压,压电,电路,极性,转换,电路,获得,EIA,正负,逻辑,电平,省略,12V,+12V,组,电源,串行,通信,软件,实现,方法,PC,机,单片,单片机,之间,实现,串行,通信,遵守,RS,232C,串行,通信,通信协议,协议,必须,具有,通信,应用,应用软件,软件,虽不,不同,单片,单片机,机系统,系统,使用,不同,汇编,汇编语言,语言,编制,应用,应用程序,程序,通信,通信软件,软件,设计,思路,PC,机,为主,主动,方式,单片,单片机,PC,机,发来,命令,判断,要求,发送,送还,接收,接收数据,数据,发送,送命,命令,准备,所需,数据,和校验,校验,校验码,填入,串行,缓冲,缓冲器,发送,发送给,送给,PC,机,读取,PC,机,送来,返回,码,错误,错误码,误码,需,重新,新发,发送,发送数据,数据,接收,命令,PC,机,发送,发送到,送到,串行,缓冲,缓冲器,数据,取出,存放,放到,固定,定存,存储,区内,接收,接收数据,数据,有错,发,一错,错误,错误码,误码,PC,机,重复,刚才,接收,收过,过程,需注意,注意,单片,单片机,PC,机,校验,数据,方法,一致,下面,详细,介绍,PC,机上,通信,通信软件,软件,实现,方法,FoxPro,for,Windows,应用,应用程序,程序,实现,单片,单片机,应用,应用程序,程序,之间,数据,据传,传递,必须,利用,API,库函数,函数,注册,运行,Windows,DLL,通信,信函,函数,来访,访问,串行,串行口,FLL,Fox,Link,Library,文件,API,使用,外部,连接,库,形式,实际,实际上,Windows,DLL,Dynamic,Link,Library,文件,允许,FoxPro,for,Windows,C,C++,汇编,汇编语言,语言,编写,程序,程序接口,接口,用户,编写,功能,函数,放入,自定,自定义,定义,FLL,库,FOXTOOLS,FLL,FoxPro,for,Windows,提供,API,库,安装,FoxPro,for,Windows,已将,放入,FOXPROW,子目,子目录,目录,FOXTOOLS,FLL,提供,不同,Windows,函数,访问,在编,编写,FoxPro,for,Windows,通信,程序,序时,先用,用以,以下,命令,装入,库,SET,LIBRARY,TO,SYS,2004,+,FOXTOOLS,FLL,ADDITIVE
,SYS,2004,返回,FoxPro,for,Windows,启动,目录,名称,加入,ADDTIVE,保证,以前,装入,库,有效,下面,命令,可取,取消,FOXTOOLS,FLL,库,RELEASE,LIBRARY,SYS,2004,+,FOXTOOLS,FLL,装入,FOXTOOLS,FLL,库,使用,库,Regfn,函数,注册,访问,Windows,通信,信函,函数,Regfn,函数,允许,用户,户调,调用,Windows,DLL,函数,DLL,允许,输入,下列,数据,数据类型,类型,整型,I,长,整数,L,浮点,F,双,精度,D,字符,字符串,C,允许,返回,上述,数据,数据类型,类型,注册,Windows,DLL,函数,参数,函数,格式,myfun,Regfn,Winfunction,Argtypes,Rtntype,Winfunction,访问,Windows,DLL,函数,数名,Argtypes,必须,传递,递给,参数,类型,代码,如要,传递,递给,函数,参数,类型,整型,整型,浮点,型,字符,型,Argtypes,IIFC,可使,使用,引用,方式,数值,方式,传递,参数,使用,引用,传递,参数,参数,类型,放,标志,参数,指向,缓冲,缓冲区,指针,Rtntype,DLL,函数,返回,返回值,数据,数据类型,类型,注册,成功,Regfn,函数,返回,个数,数字,数字型,字型,myfun,注册,失败,返回,Regfn,注册,Windows,DLL,通信,信函,函数,数成,成功,接下,接下来,下来,工作,Callfn,函数,函数调用,调用,执行,注册,函数,调用,格式,myret,Callfn,myfun,pm1,pm2,myfun,注册,函数,数值,句柄,pm1,pm2,传递,递给,Windows,DLL,函数,参数,参数值,数值,参数,数个,个数,随访,访问,DLL,函数,变,参数,数次,次序,类型,必须,严格,DLL,函数,规定,要求,传递,引起,调用,失败,Callfn,调用,成功,变量,myret,内容,Windows,DLL,函数,返回,返回值,带有,Rtntype,参数,指定,数据,数据类型,类型,应用,实例,实例,目的,利用,上面,介绍,方法,注册,通信,访问,Windows,DLL,库,函数,据实,实现,通信,步骤,执行,注册,函数,实现,FoxPro,for,Windows,环境,串行,通信,必须,包括,以下,下步,步骤,打开,访问,串行,端口,串行,串行口,初始,初始化,通信,要求,发送,接收,接收数据,数据,关闭,串行,端口,下面,FoxPro,for,Windows,语言,编制,请求,单片,单片机,发送,发送数据,数据,串行,通信,子程序,程序,Subcom,pag,
PROCEDURE,Subcom
PRIVATE,Lpmode,Lpread,num,m,rl,M,COM2
DIMENSION,acr,256,装入,FOXTOOLS,FLL,库,文件,
SET,LIBRARY,TO,SYS,2004,+,FOXTOOLS,FLL,ADDITIVE
,初始,初始化,通信,通信协议,协议,通信,端口,COM2,波特,波特率,2400,没用,奇,偶,校验,验方,方式,位数,数据,数据位,停止,
Commmode,COM2,+,2400,+,N,+,+,
Lpmode,REPLICATE,CHR,40,初始,初始化,设备,控制,块,DCB,结构,0
Lpread,REPLICATE,CHR,32,256,初始,初始化,接收,收队,队列,列为,空,长度,256B
,注册,Windows,DLL,通信,信函,函数,
buildcommDCB,Regfn,BuildCommDCB,C,C,I,
opencomm,Regfn,OpenComm,CII,I,
setcommstate,Regfn,SetCommState,C,I,
readcomm,Regfn,ReadComm,I,CI,I,
writecomm,Regfn,WriteComm,ICI,I,
closecomm,Regfn,CloseComm,I,I,
clearcomm,Regfn,GetCommError,I,C,I,初始,初始化,COM2,通信,端口,Callfn,buildcommdcb,commmode,lpmode,建立,Windows,接受,通信,方式,
COM2,Callfn,opencomm,COM2,256,256,打开,COM2,通信,信口,
IF,COM2,WAIT,WINDOW,打开,开通,通信,信口,失败,退出,重,引导,timeout,Callfn,closecomm,COM2,关闭,COM2,口,return,1
ENDIF
M,Callfn,setcommstate,lpmode,设置,通信,方式,IF,M,WAIT,WINDOW,设置,通信,方式,失败,退出,重,引导,timeout,Callfn,closecomm,COM2,return,ENDIF
,通信,信口,进行,读,写,操作,m,order,CHR,184,发,请求,求取,数据,命令,M,Callfn,writecomm,COM2,m,order,LEN,m,order,IF,M,WAIT,WINDOW,请求,失败,退出,重,引导,timeout,Callfn,clearcomm,COM2,NULL,通信,失败,清除,端口,Callfn,closecomm,COM2,释放,放缓,缓冲,缓冲区,return,ENDIF
,num,256
,M,Callfn,readcomm,COM2,lpread,num,读,num,字节,入,缓冲,缓冲区,IF,M,WAIT,WINDOW,读数,读数据,数据,失败,退出,重,引导,timeout,Callfn,clearcomm,COM2,NULL,Callfn,closecomm,COM2,return,ENDIF
,显示,接收,收到,数据,FOR,i,to,num
d,i,10,1
j,int,i,
m,siotemp,substr,lpread,i,
acr,i,ASC,SUBSTR,lpread,i,j,d,say,acr,i,
FONT,FIXEDSYS,ENDFOR
,通信,结束,Callfn,closecomm,COM2,
RELEASE,LIBRARY,SYS,2004,+,FOXTOOLS,FLL,
WAIT,WINDOW,通信,结束,NOWAIT
RETURN
,Windows,DLL,通信,信函,函数,参数,意义,请参阅,参阅,Windows,API,手册,作者,单位,南京,南京市,京市,东南,东南大学,南大,大学,热能,210096,收稿,日期,1998,07,23