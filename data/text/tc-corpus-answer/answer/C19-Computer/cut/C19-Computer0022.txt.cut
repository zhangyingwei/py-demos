计算,计算机,算机,应用,
COMPUTER,APPLICATIONS
1999,19,卷,Vol,19,No,1999



,使用,VxD,实现,Windows95,中断,处理,王,勇,盖,江南,付,长,冬,摘,本文,主要,要说,说明,Windows,95,系统,平台,台下,虚拟,拟设,设备,驱动,驱动程序,程序,VxD,处理,中断,包括,申请,占有,释放,给出,VxD,处理,中断,流程,实例,关键,关键词,VxD,硬件,中断,VPICD,VMM,虚拟,拟设,设备,系统,开发,常,需,实时,采集,状态,信息,信号,接口,接口板,传送,送给,主机,主机,中断,方式,接收,接收数据,数据,实现,现实,实时,测量,控制,系统,统通,通常,Windows,95,系统,开发,需,解决,Windows,95,中断,实现,问题,Windows,95,中断,原理,Intel,80X86,CPU,系列,芯片,规定,四个,级别,执行,代码,可信,可信度,信度,Windows,95,只用,用到,级,级,执行,级,代码,具有,最高,可信,可信度,信度,直接,硬件,中断,和文,文件,文件系统,系统,进行,物理,访问,操作,操作系统,系统,部件,允许,级,执行,应用,应用程序,程序,代码,可信,可信度,信度,最低,级,执行,访问,硬件,接触,进程,空间,以外,内存,能力,受到限制,限制,Windows,95,两种,方法,实现,中断,一种,编写,DLL,程序,一种,使用,虚拟,拟设,设备,驱动,驱动程序,程序,VxD,区别,VxD,操作,操作系统,系统,组件,运行,级,DLL,程序,运行,级,VxD,运行,虚拟,虚拟机,管理,管理器,理器,VMM,监控,之下,VMM,位于,最底层,底层,操作,操作系统,系统,系统部,部件,VMM,任务,构成,系统,硬件,虚拟,虚拟化,分配,应用,应用程序,程序,程序执行,执行,时间,片,管理,虚拟,虚拟内存,内存,内务,用户,不可,硬件,设备,数据,准备,之后,发,中断,信号,VxD,直接,截获,中断,依赖,依赖于,赖于,虚拟,可编,可编程,编程,中断,控制,控制器,VPICD,处理,硬件,中断,VPICD,虚拟,虚拟化,可编,可编程,编程,中断,控制,控制器,PIC,硬件,允许,VxD,支持,硬件,设备,磁盘,磁盘驱动器,驱动,驱动器,通信,端口,使用,硬件,中断,断去,通知,主机,输入,数据,状态,改变,VPICD,映象,硬件,中断,设备,设备,提供,服务,服务,允许,虚拟,拟设,设备,请求,中断,虚拟,虚拟机,模拟,硬件,中断,称为,虚拟,中断,处理,PIC,硬件,I,O,操作,处理,结构,结构图,构图,图,所示,

,图,VPICD,处理,结构,结构图,构图,VPICD,提供,基本,服务,VPICD,Vrtualize,IRQ
,VPICD,Set,Int,Request
,VPICD,Phys,EOI
,VPICD,Virtual,EOI
,VPICD,Clear,Int,Request
,VPICD,Force,Default,Behavior
,VPICD,Force,Default,Owner
,VPICD,Virtualze,IRQ,负责,VMM,申请,硬件,中断,IRQ,IRQ,没有,硬件,占用,得到,一个,中断,断句,句柄,设置,新,中断,处理,处理程序,程序,清除,进位,寄存,寄存器,IRQ,硬件,占用,进位,寄存,寄存器,置,VPICD,Set,Int,Request,设置,一个,指定,中断,虚拟,虚拟机,虚拟,中断,中断请求,请求,导致,虚拟,虚拟机,机系统,系统,产生,一个,虚拟,中断,VPICD,Clear,Int,Request,消除,指定,虚拟,虚拟机,设置,虚拟,中断,VPICD,Pyhs,EOI,结束,一个,硬件,中断,允许,许下,一次,硬件,中断,VPICD,Virtual,EOI,允许,VxD,VPICD,发送,虚拟,EOI,命令,结束,一个,虚拟,中断,VPICD,Force,Default,Behavior,释放,设备,VMM,申请,IRQ,允许,设备,占用,IRQ,VPICD,Force,Default,Owner,重新,新设,设置,IRQ,对应,默认,中断,处理,处理程序,程序,虚拟,拟设,设备,中断,控制,阐述,虚拟,拟设,设备,中断,控制,说明,一个,非常,关键,数据,数据结构,结构,定义,VPICD,IRQ,Descriptor,STRUC
,VID,IRQ,Number,dw,VID,Optionsdw0
,VID,Hw,Int,Procdd,VID,Virt,Int,Procdd0
,VID,EOI,Procdd0
,VID,Mask,Change,Procdd0
,VID,Iret,Procdd0
,VID,IRET,Time,Outdd500
,VID,Hw,Int,Refdd,VPICD,IRQ,Descriptor,ENDS
,数据,数据结构,结构,域,含义,VID,IRQ,Number,定义,虚拟,拟设,设备,申请,IRQ,数,VID,Options,必须,VID,Hw,Int,Proc,用户,中断,处理,处理程序,程序,地址,虚拟,虚拟化,化成,成功,系统,默认,中断,处理,处理程序,程序,地址,上三,三个,域,必须,填写,VID,Virt,Int,Proc,虚拟,中断,处理,处理程序,程序,地址,VID,EOI,Proc,物理,中断,结束,调用,调用函数,函数,指针,虚拟,拟设,设备,中断,控制,处理,处理过程,理过,过程,当用,用户,CreateFile,函数,装载,VxD,系统,VxD,发送,DEVICE,DYNAMIC,INIT,消息,VxD,消息,控制,处理,处理程序,程序,调用,对应,初始,初始化,程序,程序,下处,处理,MOV,EDI,OFFSET32,VID
VxDCall,VPICD,Virtualize,IRQ
,VID,下定,下定义,定义,假设,申请,IRQ,中断,处理,处理程序,程序,hw,int,proc,VID,VPICD,IRQ,Descriptor,hw,int,proc,中断,处理,处理程序,程序,处理,中断,必须,须按,以下,步骤,进行,调用,VPICD,Pyhs,EOI,结束,物理,中断,调用,VPICD,Set,Int,Request,设置,虚拟,中断,虚拟,中断,处理,处理程序,程序,下处,处理,真正,中断,处理,调用,VPICD,Clear,Int,Request,清除,虚拟,中断,调用,VPICD,Virtual,EOI,结束,虚拟,中断,当用,用户,CLOSEHANDLE,函数,卸载,VxD,系统,VxD,发送,DEVICE,DYNAMIC,EXIT,消息,VxD,消息,控制,处理,处理程序,程序,调用,对应,退出,出处,处理,处理程序,程序,程序,下处,处理,MOV,EDI,IRQHANDLE
VxDCALL,VPICD,Force,Default,Behavior
VxDCALL,VPICD,Force,Default,Owner
3,VxD,实现,中断,处理,实例,本节,一个,实例,说明,VxD,处理,中断,给出,实例,略有,删节,386p
,xlist
#include,vmm,inc
#include,debug,inc
#include,shell,inc
#include,vpicd,inc
,list
CVXDSAMP,DYNAMIC,EQU,申明,一个,动态,VxD,
CVXD,DEVICE,ID,EQU,28ABH,定义,虚拟,拟设,设备,标识,标识号,
VxD,LOCKED,DATA,SEG,定义,IRQ,结构,内容,CVXD,IRQ,Desc,VPICD,IRQ,Descriptor,09h,
OFFSET32,CVXD,HW,INT,
OFFSET32,CVXD,VIRT,
irqhandle,dd,0
VxD,LOCKED,DATA,ENDS,定义,VxD,参数,
DECLARE,VIRTUAL,DEVICE,CVXDSAMP,CVXD,Control,
CVXD,DEVICE,ID,UNDEFINED,INIT,ORDER
VxD,CODE,SEG
BeginProc,CVXD,Dynamic,Init
mov,edi,offset32,CVXD,IRQ,Desc
VxDcall,VPICD,Virtualize,IRQ
jc,errorhandle
mov,irqhandle,eax,保存,IRQ,句柄,
mov,eax,VXD,SUCCESS
ret
errorhandle,出错,错处,处理,
mov,eax,1
ret
EndProc,CVXD,Dynamic,Init
BeginProc,CVXD,Dynamic,Exit
mov,eax,irqhandle,返回,IRQ,句柄,
VxDcall,VPICD,Force,Default,Behavior
mov,eax,VXD,SUCCESS
ret
EndProc,CVXD,Dynamic,Exit
VxD,CODE,ENDS
VxD,LOCKED,CODE,SEG
BeginProc,CVXD,Control,消息,控制,函数,数例,例程,
Control,Dispatch,SYS,DYNAMIC,DEVICE,INIT,CVXD,Dynamic,Init
Control,Dispatch,SYS,DYNAMIC,DEVICE,EXIT,CVXD,Dynamic,Ex,it
clc
ret
EndProc,CVXD,Control
BeginProc,CVXD,HW,INT,PUBLIC,物理,中断,处理,处理函数,函数,数例,例程,
cli
mov,eax,irqhandle
VxDcall,VPICD,Phys,EOI,结束,本次,硬件,中断,
VxDcall,VPICD,Set,Int,Request,设置,一个,虚拟,中断,中断请求,请求,
clc
ret
,EndProc,CVXD,HW,INT
BeginProc,CVXD,VIRT,PUBLIC,虚拟,中断,处理,处理函数,函数,数例,例程,处理,中断,断事,事务,中断,处理,理应,处理,
mov,eax,irqhandle
VxDcall,VPICD,Clear,Int,Request,消除,指定,虚拟,虚拟机,虚拟,中断,
VxDcall,VPICD,Virtual,EOI,发送,虚拟,EOI,命令,
sti,中断,
clc,清除,进位,位标,标志,
ret
EndProc,CVXD,VIRT
VxD,LOCKED,CODE,ENDS
END
4,结束,结束语,分析,实例,看出,使用,虚拟,拟设,设备,驱动,驱动程序,程序,程序实现,实现,Windows,95,中断,处理,可靠,可靠性,更,高,速度,更快,使用,DLL,程序,快,倍,每秒,8000,中断,情况,可靠,稳定,运行,确实,开发,Windows,95,中断,程序,带来,极大,方便,作者,作者简介,简介,王,勇,助理,讲师,主要,从事,技术,技术开发,开发,系统,系统管理,统管,管理,维护,工作,盖,江南,硕士,研究,研究生,研究,方向,计算,计算机,算机,图形,图形图像,图像,图像处理,处理,付,长,冬,硕士,研究,研究生,研究,方向,操作,操作系统,系统,设计,实现,作者,单位,总装,总装备部,装备,装备部,指挥,技术,术学,学院,北京,101416,参考,参考文献,文献,A,Baker,Windows,NT,设备,驱动,驱动程序,程序,程序设计,设计,指南,北京,机械,机械工业,工业,出版,出版社,1996
,A,King,Windows,95,技术,内幕,北京,清华,清华大学,清华大学出版社,华大,大学,出版,出版社,1995
,H,Cluster,Windows,NT,技术,内幕,北京,清华,清华大学,清华大学出版社,华大,大学,出版,出版社,1996
,木,子,UNIX,设备,驱动,驱动程序,程序,北京,学苑,出版,出版社,1993
,彭,向东,使用,VtoolsD,开发,Windows95,中断,程序,电脑,信息,信息技术,技术,1998,收稿,日期,1998,12,04,修改,修改稿,改稿