计算,计算机,算机,应用,研究,
APPLICATION,RESERCH,OF,COMPUTERS
2000,Vol,17,No,P,106,108




,Windows95,环境,开发,发虚,虚拟,拟设,设备,驱动,驱动程序,程序,赫,江华,熊,莺,韦,峰,周一,勤,摘,讲述,VxD,产生,背景,描述,VxD,虚拟,虚拟机,虚拟,虚拟机,管理,管理器,理器,之间,关系,阐明,VxD,作用,详细,介绍,VxD,工作,原理,开发,发过,过程,最后,给出,一个,VxD,程序,实例,梈,Packet,vxd,关键,关键词,VMM,VM,VxD,DDB,DCP,Service,Table,API
1,引言,Windows95,结构,虚拟,虚拟环境,环境,保证,应用,应用软件,软件,多种,平台,台上,运行,Windows95,支持,Win16,Win32,应用,应用程序,程序,支持,MS,DOS,应用,应用程序,程序,运行,成为,一个,完整,32,多任务,任务,抢占,式,操作,操作系统,系统,Win95,操作,操作系统,系统,强,兼容,兼容性,容性,层次,式,体系,体系结构,结构,中建,建构,一个,虚拟,虚拟环境,环境,实现,Win95,结构,结构组件,组件,包括,三个,虚拟,虚拟机,Virtual,Machine,虚拟,虚拟机,管理,管理器,理器,Virtual,Machine,Manager,虚拟,拟设,设备,驱动,驱动程序,程序,VxD,Win95,应用,应用程序,程序,虚拟,虚拟机,执行,虚拟,虚拟机,两种,MS,DOS,虚拟,虚拟机,系统,虚拟,虚拟机,每个,虚拟,虚拟机,可运,运行,DOS,应用,应用程序,程序,一个,DOS,虚拟,虚拟机,运行,一个,DOS,应用,应用程序,程序,Windows,应用,应用程序,程序,DLL,系统,虚拟,虚拟机,运行,虚拟,虚拟机,好处,每个,虚拟,虚拟机,独立,地址,空间,I,O,空间,寄存,寄存器,堆栈,局部,描述,描述符,表,中断,中断向量,向量,量表,执行,优先,优先权,多个,虚拟,虚拟机,同步,工作,互不,干扰,用户,透明,每个,虚拟,虚拟机,可使,使用,系统,系统资源,资源,虚拟,控制,整个,系统,虚拟,管理,管理器,理器,Windows,虚拟,虚拟环境,环境,处于,核心,心地,地位,作用,产生,卸载,虚拟,虚拟机,协调,调和,调度,虚拟,虚拟机,工作,并作,虚拟,虚拟机,虚拟,拟设,设备,驱动,驱动程序,程序,打交道,交道,接口,负责,虚拟,虚拟内存,内存,管理,工作,每个,虚拟,虚拟机,可使,使用,系统,软硬,软硬件,硬件,硬件资源,资源,存在,资源,冲突,共享,问题,解决,问题,Win95,硬件,设备,抽象,一个,一个个,个个,虚拟,拟设,设备,用户,若要,访问,底层,硬件,实际,实际上,访问,虚拟,拟设,设备,驱动,驱动程序,程序,VxD,也就是说,虚拟,虚拟机,机上,运行,任务,软硬,软硬件,硬件,硬件资源,资源,之间,接口,VxD,定义,Windows95,各部,部分,之间,关系,Win16,版本,整个,加载,设备,驱动,驱动程序,程序,过程,系统,启动,启动时,Windows,寻找,SYSTEM,INI,文件,读出,此文,文件,386nh,节,内容,此节,格式,device,xxxx,驱动,驱动程序,程序,设备,驱动,驱动程序,程序,系统,初始,初始化,化时,加载,带来,三个,问题,设备,驱动,驱动程序,程序,需不需要,需要,设备,驱动,驱动程序,程序,初始,初始化,化时,加载,设备,驱动,驱动程序,程序,加载,不能,卸载,系统,系统文件,文件,SYSTEM,INI,内容,无法,自动,动地,实际,硬件,环境,保持,保持一致,一致,一致,一致性,需,程序,用户,维护,第一,第一个,一个,第二,第二个,二个,问题,带来,缺点,系统,系统资源,资源,浪费,VxD,起始,始于,Windows,386,增强,模式,Win95,解决,问题,加入,VxD,全称,Virtual,Device,Driver,x,设备,名,统称,虚拟,鼠标,设备,驱动,驱动程序,程序,称为,VMD,虚拟,显示,设备,VDD,VxD,文件,设备,虚拟,虚拟化,95,动态,检测,硬件,配置,自动,动地,加载,合适,设备,驱动,驱动程序,程序,动态,卸载,重载,不同,虚拟,拟设,设备,驱动,驱动程序,程序,虚拟,虚拟机,虚拟,虚拟机,管理,管理程序,程序,VxD,之间,关系,可用,图,表示,

,图,VM,VMM,VXD,关系,图,虚拟,虚拟机,管理,管理器,理器,VxD,集合,构成,Win9x,系统,核心,VxD,VMM,之间,关系,十分,紧密,VMM,一个,特殊,VxD,VxD,DLL,形式,链,入,Windows,操作,操作系统,系统,核心,核心层,环,VxD,VMM,监控,运行,协作,VxD,具有,应用,应用程序,程序,不具,具备,能力,特殊,能力,包括,不受,限制,访问,硬件,设备,访问,内存,区域,保护,保护模式,模式,访问,绝对,物理,物理地址,地址,麻烦,问题,编写,写访问,访问,物理,物理地址,地址,VxD,解决,问题,任意,查看,操作,操作系统,系统,数据,数据结构,结构,捕获,软件,中断,截取,硬件,中断,捕获,I,O,端口,操作,VxD,功能,能及,作用,情况,VxD,作用,支持,硬件,设备,管理,虚拟,虚拟化,一具,硬件,设备,驱动,驱动程序,程序,功能,应用,应用程序,程序,提供,硬件,接口,环境,用以,同步,协调,虚拟,虚拟机,设备,访问,VxD,提供,服务,实,模式,软件,提供,供应,应用,应用程序,程序,编程,接口,VxD,作用,不仅仅,仅仅,仅限,仅限于,限于,于此,可作,设备,驱动,驱动程序,程序,虚拟,虚拟化,设备,VxD,硬件,设备,没有,关系,VxD,应用,应用程序,程序,提供,服务,软件,虚拟,虚拟机,机上,运行,行时,并不认为,认为,虚设,设备,实设,设备,备有,不同,软件,一级,看来,完全,虚拟,拟设,设备,驱动,驱动程序,程序,运行,环境,虚拟,拟设,设备,驱动,驱动程序,程序,Windows,9x,以下,平台,此种,设备,虚拟,虚拟化,机制,提供,提供商,特定,硬件,设备,编写,驱动,驱动程序,程序,不同,同类,类型,设备,可用,一种,标准,方式,处理,需要,注意,Windows,操作,操作系统,系统,多个,版本,采用,核心,核心技术,技术,不同,体系,体系结构,结构,发生,众多,变化,不同,Windows,操作,操作系统,系统,统编,编制,虚拟,拟设,设备,驱动,驱动程序,程序,方法,不同,Windows,版本,底层,结构,没有,太大,变化,Win3,x,编写,设备,驱动,驱动程序,程序,基本,可不,不加,修改,Win95,Win98,平台,台下,下工,工作,VxD,结构,运行,原理,结构,一个,标准,VxD,部分,分组,组成,部分,分分,别存,存放,放在,不同,段,VxD,CODE,必须,段,保护,保护模式,模式,代码,代码段,包括,虚拟,拟设,设备,设备,控制,过程,DCP,回调,函数,服务,服务例程,例程,API,函数,设备,控制,过程,接收,VMM,消息,决定,消息,反应,VxD,服务,服务例程,例程,一批,VxD,可使,使用,函数,以使,VxD,访问,VxD,控制,资源,VxD,API,函数,一批,实,模式,保护,式,任务,调用,函数,应用,应用程序,程序,INT,2FH,得到,API,入口,调用,API,函数,实现,设备,访问,大多,大多数,多数,应用,应用程序,程序,这种,方式,访问,设备,编程,VxD,CODE,SEG,VxD,CODE,END,宏,定义,此段,一段,叫做,LTEXT,VxD,DATA,必须,段,保护,保护模式,模式,数据,段,包括,虚拟,拟设,设备,设备,设备描述,描述,块,DDB,各服,服务,服务例程,例程,地址,构成,服务,表,虚拟,拟设,设备,使用,全局,局数,数据,DDB,Device,Descriptor,Block,保存,VxD,关键,信息,包括,设备,名,DCP,地址,版本,版本号,初始,初始化,顺序,API,函数,地址,信息,VxD,VMM,VM,运行,任务,至关,至关重要,重要,编程,使用,VxD,DATA,SEG,VxD,DATA,ENDS,定义,一段,叫做,LDATA,VxD,ICODE,可选,选段,保护,保护模式,模式,初始,初始化,代码,代码段,通常,包括,用于,虚拟,拟设,设备,初始,初始化,阶段,过程,和服,服务,VxD,响应,VMM,三个,阶段,发送,三条,初始,初始化,消息,并进,进行,响应,阶段,初始,初始化,操作,VMM,发送,消息,Init,Complete,丢弃,该段,编程,使用,VxD,ICODE,SEG,VxD,ICODE,ENDS,定义,一段,叫做,ITEXT
,VxD,IDATA,可选,选段,保护,保护模式,模式,初始,初始化,数据,段,通常,包括,虚拟,拟设,设备,初始,初始化,过程,和服,服务,使用,数据,VMM,发送,消息,Init,Complete,丢弃,该段,编程,使用,VxD,IDATA,SEG,VxD,IDATA,ENDS,定义,一段,叫做,IDATA,VxD,REAL,INIT,可选,选段,实,模式,初始,初始化,段,包括,虚拟,拟设,设备,初始,初始化,过程,初始,初始化,化用,用到,数据,段,存放,运行,环境,检测,资源,判断,语句,并进,进行,行相,相应,阶段,初始,初始化,操作,VMM,加载,虚拟,拟设,设备,余段,之前,调用,过程,过程,返回,丢弃,该段,编程,使用,VxD,REAL,INIT,SEG,VxD,REAL,INIT,ENDS,定义,一段,叫做,RTEXT,运行,原理,VxD,初始,初始化,过程,每个,VxD,初始,初始化,过程,不同,模式,不同,同过,过程,不同,过程,大致,Windows,初始,初始化,化时,一个,VxD,照设,设备,设备描述,描述,块,定义,初始,初始化,顺序,进行,初始,初始化,化工,工作,一般说来,应当,优先,优先级,顺序,装入,顺序,初始,初始化,VxD,VxD,INITVxD,装载,初始,初始化,VMM,完成,VMM,调用,VxD,定义,实,模式,保护,保护模式,模式,初始,初始化,过程,完成,VxD,初始,初始化,VMM,以下,下步,步骤,进行,VxD,初始,初始化,装入,VxD,实,模式,初始,初始化,段,调用,实,模式,初始,初始化,过程,过程,判断,VxD,是否,装入,Windows,是否,启动,指定,虚拟,拟设,设备,所需,实例,例数,数据,在内,内存,中选,选择,虚拟,拟设,设备,所需,独占,使用,页,32,单层,模型,保护,保护模式,模式,内存,中装,装入,虚拟,拟设,设备,余段,丢弃,实,模式,初始,初始化,段,VMM,VxD,InitOrder,排序,进行,初始,初始化,发送,Sys,Critical,Init,消息,设备,控制,过程,硬件,中断,被禁,禁止,发送,Device,Init,消息,设备,控制,过程,允许,硬件,中断,虚拟,拟设,设备,必须,管理,硬件,中断,发送,Init,Complete,消息,设备,控制,过程,丢弃,初始,初始化,代码,数据,段,释放,用于,目的,内存,虚拟,拟设,设备,处理,Init,Complete,消息,不能,存取,段,过程,数据,初始,初始化,阶段,任何时刻,时刻,VxD,设置,标志,告诉,VMM,终止,VxD,装入,VMM,完成,每个,VxD,初始,初始化,Windows,模块,GUI,装入,执行,VxD,提供,服务,API,函数,VxD,提供,服务,VMM,特定,VxD,提供,函数,服务,VxD,使用,VxD,DDB,两个,字段,指定,VxD,提供,服务,一个,DDB,Service,Table,Ptr,指向,服务,表,指针,一个,DDB,Service,Table,Size,服务,入口,表,项数,VxD,提供,服务,函数,服务,表,定义,服务,VMMCall,VxDCALL,宏,调用,VxD,提供,第一,第一个,一个,函数,应该,该是,Get,Vercion,函数,供,调用,调用者,用者,确认,VxD,有效,有效性,VxD,API,过程,地址,DDB,表,定义,提供,API,函数,VxD,实,模式,保护,保护模式,模式,运行,任务,提供,正确,访问,设备,手段,VxD,正确,初始,初始化,载入,一个,运行,虚拟,虚拟机,机上,系统,软硬,软硬件,硬件,打交道,交道,程序,设备,访问,过程,程序,发出,出访,访问,请求,请求,各种渠道,渠道,最后,到达,虚拟,虚拟机,管理,管理器,理器,VMM,请求,求解,解释,传给,设备,VxD,VxD,请求,求进,进行,理解,协调,调处,处理,理当,当前,状态,请求,发送,发送给,送给,物理,设备,物理,设备,返回,数据,VxD,传给,VMM,VMM,传递,递给,虚拟,虚拟机,机上,程序,编写,虚拟,拟设,设备,驱动,驱动程序,程序,VxD,开发,步骤,以前,VxD,Intel,汇编,汇编语言,语言,编写,目的,提高,高速,高速度,速度,现在,VxD,可用,C++,类库,编写,软件,公司,提供,开发,VxD,工具,工具包,VtoolsD,for,Win95,开发,开发工具,工具,工具包,创建,虚拟,拟设,设备,可有,两种,方法,一种,直接,设备,进行,修改,一种,重新,新编,编写,一个,虚拟,拟设,设备,创建,虚拟,拟设,设备,步骤,包括,阅读,硬件,设备,类型,合适,虚拟,拟设,设备,说明,说明文,明文,文档,目标,设备,进行,虚拟,虚拟化,设计,决定,目标,VxD,专用,部分,分设,设计,建立,总体,框架,这部,这部分,部分,分工,工作,包括,DDB,DCP,Service,Table,空,API,过程,定义,构造,VxD,段,建起,一个,VxD,框架,编写,初始,初始化,代码,设计,实,模式,保护,保护模式,模式,初始,初始化,过程,代码,数据,编写,VxD,所需,控制,制模,模块,虚拟,拟设,设备,服务,API,函数,编写,模块,模块化,定义,文件,此文,文件,包括,虚拟,拟设,设备,名称,设备,所需,描述,块,编译,链接,接设备,设备,使用,Windows95,环境,调试,调试器,测试,虚拟,拟设,设备,阅读,调试,虚拟,拟设,设备,文档,虚拟,拟设,设备,创建,建安,安装,安装文件,文件,INF,相关,文件,VxD,载入,Windows,注册,注册表,项目,目的,登记,文件,拷贝,拷贝到,Windows,系统,系统目录,目录,相关,目录,录下,实例,开发,开发局,局域,局域网,共享,Modem,软件,Modem,Proxy,98DDK,VC++6,MASM6,11,开发,NDIS,协议,驱动,驱动程序,程序,ZPacket,vxd,协议,驱动,驱动程序,程序,NDIS,规范,向上,上层,应用,提供,设置,网卡,接收,模式,收,发,以太,帧,服务,结构,框架,图,所示,

,图,ModemProxy,结构,结构图,构图,说明,Modem,Proxy,使用,CreateFile,系统,函数,ZPacket,vxd,动态,装入,系统,ZPacket,vxd,绑定,定于,网卡,拨号,拨号网络,网络,网络适配器,适配,适配器,配器,网卡,接收,模式,设置,PROMISCUOUS,模式,监听,以太,以太网,网上,有数,数据,数据包,Modem,Proxy,ZPacket,vxd,获取,局域,局域网,网上,以太,帧,进行,必要,协议,议处,处理,ZPacket,vxd,拨号,拨号网络,网络,转发,发至,Internet,Modem,Proxy,ZPacket,vxd,获取,Internet,数据,数据包,进行,必要,协议,议处,处理,ZPacket,vxd,网卡,转发,发至,局域,局域网,赫,江华,武汉,武汉大学,大学,数学,计算,计算机,计算机科学,算机,科学,科学学,学学,学院,武汉,430072,熊,莺,武汉,武汉大学,大学,数学,计算,计算机,计算机科学,算机,科学,科学学,学学,学院,武汉,430072,韦,峰,武汉,武汉大学,大学,数学,计算,计算机,计算机科学,算机,科学,科学学,学学,学院,武汉,430072,周一,勤,武汉,武汉大学,大学,数学,计算,计算机,计算机科学,算机,科学,科学学,学学,学院,武汉,430072,参考,参考文献,文献,徐,志海,Win95,利用,VxD,访问,物理,物理地址,地址,微,计算,计算机,算机,应用,Vol,19,No,May,l998
2,魏晋,鹏,Windows,深入,剖析,棾,跏,蓟,北京,清华,清华大学,清华大学出版社,华大,大学,出版,出版社,1997
3,美,Matt,Pietrek,著,米,东,王,森,译,Windows95,系统,统编,编程,奥秘,北京,电子,工业,出版,出版社,1996,月,收稿,日期,1999,月,28,日