软件,学报,
Journal,of,Software
2000,Vol,11,No,P,122,125



,一个,虚拟,Internet,服务,服务器,务器,设计,实现,章,文,嵩,吴,婷婷,金士尧,吴,泉源,摘,已有,解决,Internet,服务,服务器,务器,性能,瓶颈,可靠,可靠性,问题,方法,所存,存在,不足,提出,IP,层,负载,负载平衡,平衡,调度,解决,方法,一组,服务,服务器,务器,构成,一个,伸缩,高,可用,虚拟,Internet,服务,服务器,务器,服务,机群,透明,加入,删除,结点,实现,系统,伸缩,伸缩性,检测,结点,服务,进程,故障,正确,重置,系统,达到,高可用性,可用,可用性,详细,讨论,虚拟,Internet,服务,服务器,务器,体系,体系结构,结构,设计,方法,实现,技术,给出,相应,性能,测试,关键,关键词,Internet,服务,服务器,务器,负载,负载平衡,平衡,高可用性,可用,可用性,网络,网络地址,地址,转换,中图,中图法,图法,分类,分类号,TP393
Design,and,Implementation,of,a,Virtual,Internet,Server
ZHANG,Wen,song,WU,Ting,ting,JIN,Shi,yao,WU,Quan,yuan
,School,of,Computer,National,University,of,Defense,Technology,Changsha,410073,
Abstract,The,shortcomings,of,the,existing,solutions,to,the,performance,bottleneck,and,reliability,problem,of,Internet,servers,are,analyzed,and,a,solution,based,on,IP,level,load,balancing,is,given,in,this,paper,in,which,a,scalable,and,highly,available,virtual,Internet,server,can,be,built,on,a,cluster,of,servers,Scalability,is,achieved,by,transparently,adding,or,removing,a,node,in,the,cluster,High,availability,can,be,provided,by,detecting,the,node,or,daemon,failures,and,reconfiguring,the,system,appropriately,The,architecture,design,and,implementation,of,the,virtual,Internet,server,are,discussed,in,detail,Brief,performance,testing,results,are,also,provided,
Key,words,Internet,server,load,balance,high,availability,network,address,translation,当今,计算,计算机,计算机技术,算机,技术,进入,网络,中心,计算,时期,大量,应用,围绕,网络,进行,服务,服务器,务器,性能,可靠,可靠性,提出,越来,越来越,高,要求,Internet,飞速,飞速发展,发展,用户,剧烈,增长,比较,热门,Web,站点,访问,次数,急剧,剧增,增长,不能,能及,及时,及时处理,处理,用户,请求,导致,导致用户,致用,用户,户长,长时间,时间,等待,大大,大大降低,降低,服务,服务质量,质量,Web,服务,服务器,务器,性能,往往,成为,整个,系统,瓶颈,当在,Web,服务,服务器,务器,大量,使用,CGI,数据,数据库,据库,CPU,密集,密集型,应用,情况,服务,服务器,务器,性能,瓶颈,问题,更加,突出,电子,电子商务,商务,关键,关键性,应用,网上,运行,例外,服务,中断,造成,不可,不可估量,估量,损失,服务,服务器,务器,可靠,可靠性,越来,越来越,越来越重,重要,有效,解决,Internet,服务,服务器,务器,性能,瓶颈,可靠,可靠性,问题,给出,IP,层,负载,负载平衡,平衡,调度,解决,方法,一组,服务,服务器,务器,构成,一个,伸缩,高,可用,虚拟,Internet,服务,服务器,务器,使用,网络,网络地址,地址,转换,服务,服务器,务器,组,复杂,结构,用户,透明,系统,伸缩,伸缩性,服务,机群,透明,加入,删除,一个,节点,达到,检测,节点,服务,进程,故障,正确,重置,系统,达到,高可用性,可用,可用性,相关,解决,方法,解决,服务,服务器,务器,性能,瓶颈,问题,现有,有方,方法,主要,分为,以下,单服,服务,服务器,务器,解决,方法,服务,服务器,务器,性能,成为,瓶颈,简单,方法,升级,更,高档,服务,服务器,务器,方法,以下,不足,升级,过程,繁琐,机器,切换,服务,暂时,中断,造成,原有,计算,计算资源,资源,浪费,高端,端的,服务,服务器,务器,发展,所花,花费,代价,该服,服务,服务器,务器,应用,应用软件,软件,失效,导致,整个,服务,中断,RR,DNS,多服,服务,服务器,务器,解决,方法,NCSA,National,Center,of,Supercomputing,Applications,伸缩,WEB,服务,服务器,务器,系统,最早,轮转,域名,名系,系统,RR,DNS,round,robin,domain,name,system,原型,系统,基本,思想,RR,DNS,服务,服务器,务器,域名,轮流,解析,组,Web,服务,服务器,务器,不同,IP,地址,负载,分到,台服,服务,服务器,务器,提高,整个,系统,性能,方法,存在,以下,问题,域名,域名服务,服务,系统,层次,层次结构,结构,组织,各级,域名,域名服务,服务,服务器,务器,缓冲,解析,名字,IP,地址,映射,妨碍,Round,Robin,方法,客户,客户端,生效,导致,不同,WEB,服务,服务器,务器,严重,负载,不平,平衡,域名,IP,地址,地址映射,映射,TTL,time,to,live,设定,太大,负载,不平,平衡,更,严重,太小,频繁,域名,域名解析,解析,RR,DNS,成为,系统,一个,新,瓶颈,用户,访问,请求,突发,突发性,发性,访问,方式,不同,TTL,各服,服务,服务器,务器,负载,存在,较严,严重,负载,不平,平衡,问题,系统,可靠,可靠性,可维护性,维护,维护性,差,一台,台服,服务,服务器,务器,失效,管理,管理员,进行,维护,均,导致,域名,解析,该服,服务,服务器,务器,用户,出现,服务,中止,应用,应用层,负载,负载平衡,平衡,调度,多服,服务,服务器,务器,解决,方法,EDDIE,Reverse,Proxy,pWEB,使用,应用,应用层,调度,方法,建立,一个,伸缩,WEB,服务,服务器,务器,到达,HTTP,请求,转发,发到,不同,Web,服务,服务器,务器,取得,返回,用户,方法,存在,问题,系统,处理,开销,特别,致使,系统,伸缩,伸缩性,有限,请求,到达,处理,结束,调度,器,需要,进行,核心,用户,空间,切换,用户,调度,器,调度,器,真实,服务,服务器,务器,两次,TCP,连接,需要,请求,求进,进行,分析,重写,般地,服务,服务器,务器,组,数目,增加,加时,调度,器,很快,成为,新,瓶颈,文献,Linux,版本,应用,快速,速报,报文,插入,技术,进行,负载,负载平衡,平衡,调度,用户,进程,访问,网络,网络设备,设备,接近,核心,心空,空间,速度,降低,上下文,下文,切换,处理,开销,彻底,应用,应用层,负载,负载平衡,平衡,调度,器,应用,协议,密切,密切相关,相关,HTTP,Proxy,SMTP,应用,协议,需要,写,不同,调度,器,虚拟,Internet,服务,服务器,务器,体系,体系结构,结构,虚拟,Internet,服务,服务器,务器,采用,IP,层,负载,负载平衡,平衡,调度,技术,操作,操作系统,系统,系统核心,核心,心空,空间,中将,IP,层,TCP,连接,负载,均衡,转移,移到,不同,服务,服务器,务器,调度,器,自动,屏蔽,屏蔽掉,服务,服务器,务器,故障,一组,服务,服务器,务器,构成,一个,高性,高性能,性能,高,可用,虚拟,Internet,服务,服务器,务器,虚拟,Internet,服务,服务器,务器,体系,体系结构,结构,图,所示,整个,服务,服务器,务器,组,复杂,结构,用户,透明,用户,看到,单个,服务,服务器,务器,无需,修改,客户,客户端,和服,服务,服务器,服务器端,务器,端的,程序,设计,计时,需要,考虑,系统,透明,透明性,明性,负载,均衡,均衡性,容错,容错性,和易,易管理性,管理,管理性,理性,


Fig,Architecture,of,a,virtual,Internet,server
,图,虚拟,Internet,服务,服务器,务器,体系,体系结构,结构,透明,透明性,明性,网络,网络地址,地址,转换,透明,透明性,明性,网络,网络地址,地址,转换,实现,当用,用户,Virtual,IP,Address,调度,器,外部,地址,访问,服务,服务器,服务器时,务器,请求,报文,到达,调度,器,调度,器,负载,均衡,方法,一组,真实,服务,服务器,务器,选出,一个,报文,目标,地址,Virtual,IP,Address,改写,写成,选定,服务,服务器,务器,地址,报文,目标,端口,改写,写成,选定,服务,服务器,务器,相应,端口,最后,报文,发送,发送给,送给,选定,服务,服务器,务器,调度,器,Hash,表,记录,连接,连接,一个,报文,到达,Hash,表,得到,原,选定,服务,服务器,务器,地址,端口,进行,行同,同样,改写,操作,报文,文传,传给,原,选定,服务,服务器,务器,真实,服务,服务器,务器,回应,应报,报文,调度,器,报文,源地,源地址,地址,源,端口,改为,Virtual,IP,Address,相应,端口,报文,发给,用户,连接,终止,超时,时时,调度,器,连接,Hash,表,删除,用户,看到,Virtual,IP,Address,提供,服务,虚拟,服务,服务器,务器,结构,用户,透明,改写,报文,应用,增量,调整,Checksum,算法,调整,TCP,Checksum,避免,扫描,整个,报文,计算,Checksum,开销,负载,负载平衡,平衡,负载,负载平衡,平衡,调度,TCP,连接,粒度,HTTP,协议,WEB,服务,服务器,务器,获取,每个,对象,需要,建立,一个,TCP,连接,同一,用户,不同,请求,调度,不同,服务,服务器,务器,这种,细粒,细粒度,粒度,调度,完全,完全避免,避免,用户,访问,突发,突发性,发性,引起,负载,不平,平衡,问题,调度,算法,采用,轮转,转调,调度,round,robin,scheduling,算法,权,轮转,转调,调度,weighted,round,robinscheduling,算法,轮转,转调,调度,算法,假设,服务,服务器,务器,处理,理性,性能,均,相同,依次,请求,调度,不同,服务,服务器,务器,算法,简单,不适,适用,用于,服务,服务器,务器,组,处理,理性,性能,不一,情况,使用,权,轮转,转调,调度,算法,相应,权,表示,服务,服务器,务器,处理,理性,性能,请求,求数,数目,权,比例,分配,配到,各服,服务,服务器,务器,调度,器,需要,记录,服务,服务器,务器,建立,TCP,连接,数目,台服,服务,服务器,务器,调度,连接,连接数,连接,中止,超时,连接,连接数,减,假设,台服,服务,服务器,务器,权,Wi,i,n,TCP,连接,连接数,数目,Ti,i,n,依次,选,Ti,Wi,最小,服务,服务器,务器,调度,对象,算法,实现,比较,容易,服务,服务器,务器,无关,故障,检测,采用,两种,方法,检测,故障,一种,方法,资源,监测,监测器,测器,每隔,t,毫秒,每个,服务,服务器,务器,发,ARP,address,resolve,protocol,请求,服务,服务器,务器,超,r,毫秒,没有,没有响应,响应,说明,该服,服务,服务器,务器,发生,故障,资源,监测,监测器,测器,通知,调度,器,该服,服务,服务器,务器,服务,进程,调度,调度,列表,删除,一种,方法,资源,监测,监测器,测器,定时,每个,服务,进程,发,请求,不能,返回,说明,该服,服务,进程,发生,故障,资源,监测,监测器,测器,通知,调度,器,该服,服务,进程,调度,调度,列表,删除,资源,监测,监测器,测器,过电,电子,电子邮件,邮件,传呼,传呼机,呼机,管理,管理员,报告,故障,监测,测到,服务,进程,恢复,复工,工作,通知,调度,器,加入,调度,列表,进行,调度,服务,服务器,务器,管理,服务,服务器,务器,可运,运行,支持,TCP,IP,操作,操作系统,系统,采用,Internet,服务,服务器,服务器软件,务器,软件,无需,客户,客户程序,程序,修改,适用,用于,Internet,站点,系统,提供,管理,管理程序,程序,管理,管理员,可发,命令,一台,台机,机器,加入,服务,切出,服务,系统,实现,Linux,操作,操作系统,系统,源代码,代码,加入,改写,000,多行,C,语言,代码,IP,层,截取,改写,IP,报文,实现,伸缩,虚拟,Internet,服务,服务器,务器,并提,提供,一个,ippfvsadm,程序,进行,虚拟,服务,服务器,务器,管理,系统,源程序,程序,使用,说明,网上,发布,已经,访问,000,多次,所知,该系,系统,美,英,德,澳,国,十几,十几个,几个,站点,正式,使用,系统,主要,功能,功能模块,模块,图,所示,PFVS,Module,虚拟,服务,服务器,务器,主控,模块,用于,截取,改写,IP,报文,PFVS,table,表,存放,虚拟,服务,服务器,务器,规则,Hash,of,Connections,表,用于,记录,当前,连接,Hash,表,ippfvsadm,管理,管理程序,程序,setsockopt,函数,虚拟,服务,服务器,务器,规则,写入,PFVS,table,表,proc,文件,文件系统,系统,PFVS,table,表,规则,读出,

Fig,Mail,modules,of,the,system
,图,系统,主要,模块,性能,测试,台,Web,服务,服务器,务器,多台,Web,服务,服务器,务器,构成,虚拟,Web,服务,服务器,务器,最大,吞吐,率,延时,进行,测试,测试,测试软件,软件,美国,ZD,LABS,WebBench,服务,服务器,务器,Pentium,166,32M,内存,100M,Intel,EtherExpress,网卡,PC,运行,Linux,操作,操作系统,系统,Web,服务,服务器,务器,Apache,客户,客户机,PC,共有,台,运行,Windows,95,NT,操作,操作系统,系统,10,100M,自适,适应,3Com,Switch,3000,交换,交换机,换机,相连,WebBench,测试,一个,主控,进程,多个,模拟,访问,客户,进程,主控,进程,生成,工作,负载,参数,发给,客户,进程,客户,进程,连续,访问,服务,服务器,务器,记录,测试,测试数据,数据,测试,完毕,主控,进程,汇报,最后,主控,进程,进行,统计,测试,表,
Table,Brief,testing,results,of,Webserves
,表,Web,服务,服务器,务器,性能,测试,Requests,per,second,GETs,s,Throughput,Bytes,s,Processing,delay,ms,
Single,Web,Server,97648,95835,516
Virtual,Web,Server,set,1901269,24538,474
Virtual,Web,Server,set,2821930,93438,928
,每秒,处理,请求,求数,吞吐,率,处理,延时,台,Web,服务,服务器,务器,虚拟,Web,服务,服务器,务器,tcpdump,程序,测试,试得,现有,配置,下调,调度,器重,重写,一个,报文,平均,延时,60,s,一个,报文,平均,长度,536,字节,非本,IP,连接,最大,大段,段长,段长度,长度,重写,报文,最大,吞吐,率,93MBytes,s,假设,Web,服务,服务器,务器,平均,吞吐,率,600KBytes,s,服务,服务器,务器,数目,升到,15,台,达到,虚拟,服务,服务器,务器,最大,吞吐,率,具有,良好,伸缩,伸缩性,结束,结束语,本文,解决,Internet,服务,服务器,务器,瓶颈,问题,已有,有方,方法,进行,分析,比较,指出,存在,不足,给出,IP,层,调度,多服,服务,服务器,务器,解决,方法,网络,网络地址,地址,转换,负载,负载平衡,平衡,调度,故障,检测,技术,一组,提供,并行,服务,服务,服务器,务器,构成,一个,高性,高性能,性能,高,可用,虚拟,Internet,服务,服务器,务器,方法,具有,良好,伸缩,伸缩性,无需,客户,客户机,和服,服务,服务器,务器,修改,适用,用于,Internet,站点,章,文,嵩,国防,国防科,国防科学技术大学,科学,科学技术,技术,大学,计算,计算机,算机,学院,长沙,410073,吴,婷婷,国防,国防科,国防科学技术大学,科学,科学技术,技术,大学,计算,计算机,算机,学院,长沙,410073,金士尧,国防,国防科,国防科学技术大学,科学,科学技术,技术,大学,计算,计算机,算机,学院,长沙,410073,吴,泉源,国防,国防科,国防科学技术大学,科学,科学技术,技术,大学,计算,计算机,算机,学院,长沙,410073,
E,mail,wensong,iinchina,net
,参考,参考文献,文献,Katz,E,D,Butler,M,McGrath,R,A,scalable,HTTP,server,the,NCSA,prototype,Computer,Networks,and,ISDN,Systems,1994,27,687,155,163
2,Kwan,T,T,McGrath,R,E,Reed,D,A,NCSA,s,world,wide,web,server,design,and,performance,IEEE,Computer,1995,28,11,68,74
3,Brisco,T,DNS,support,for,load,balancing,RFC,1794,1995,http,andrew2,andrew,cmu,edu,rfc,rfc1974,html
4,Dahlin,A,Froberg,M,Walerud,J,et,al,EDDIE,a,robust,and,scalable,Internet,server,1998,http,www,eddieware,org,Engelschall,R,S,Load,balancing,your,Web,site,practical,approaches,for,distributing,HTTP,traffic,Web,Techniques,Magazine,1998,http,www,webtechniques,com
6,Walker,E,pWEB,a,parallel,Web,server,harness,1997,http,www,ihpc,nus,edu,sg,STAFF,edward,pweb,html
7,Anderson,E,Patterson,D,Brewer,E,The,magicrouter,an,application,of,fast,packet,interposing,1996,http,www,cs,berkeley,edu,eanders,magicrouter,Rijsinghani,A,et,al,Computation,of,the,Internet,checksum,via,incremental,update,RFC,1624,1994,http,www,internic,net,ds,Fielding,R,Gettys,J,Mogul,J,et,al,Hypertext,Transfer,protocol,HTTP,1997,Http,www,w3,org,Protocols,
1998,10,26,收稿,
1999,03,01,修,稿